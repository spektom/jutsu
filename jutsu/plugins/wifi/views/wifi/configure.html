{% extends "core/base.html" %}

{% block head %}
<link href="/wifi/static/css/wifi.css" rel="stylesheet">
{% endblock %}

{% block content %}
<legend>Wi-Fi Configuration</legend>
<form role="form" class="form-horizontal">
	<fieldset>
		<div class="form-group">
			<label for="iface" class="control-label col-md-3">Network Interface</label>
			<select id="iface" name="iface" class="selectpicker col-md-4">
				<option value="" default> - select network interface - </option>
				{% for iface in ifaces %}
				<option value="{{ iface }}">{{ iface }}</option>
				{% endfor %}
			</select>
		</div>
		<div class="form-group">
			<label class="control-label col-md-3">SSID</label>
			<select id="ssid" name="ssid" class="selectpicker col-md-4" data-live-search="true" disabled>
				<option value="" default> - select SSID - </option>
			</select>
			<a href='javascript:void(0);' id='ssid-refresh-link'><i class='fa fa-refresh' id='ssid-refresh'></i></a>
		</div>
		<div class="form-group">
			<button type="submit" class="btn btn-primary">Connect</button>
		</div>
	</fieldset>
</form>
{% endblock %}

{% block body %}
<script>
function refresh_ssid() {
	var iface = $("#iface").find('option:selected').val();
	$("#ssid-refresh").addClass('fa-spin');
	var list = $("#ssid");
	list.prop('disabled', true).find('option:not(:first)').remove().selectpicker('refresh');
	$.get("/wifi/scan/" + encodeURIComponent(iface), function(data) {
		if (data.results) {
			for (var i = 0; i < data.results.length; ++i) {
				var ssid = data.results[i].ssid;
				if (ssid) {
					list.append("<option value='" + ssid + "'>" + ssid + "</option>");
				}
			}
		}
	}).always(function() {
		setTimeout(function() {
			$("#ssid-refresh").removeClass('fa-spin');
			list.prop('disabled', false).selectpicker('refresh');
		}, 2000);
	});
}
$("#iface").change(function() {
	refresh_ssid();
});
$("#ssid-refresh-link").on('click', function() {
	refresh_ssid();
});
</script>
{% endblock %}
